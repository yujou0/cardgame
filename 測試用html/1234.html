<!DOCTYPE html>
<html lang="en">
	<head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta http-equiv="X-UA-Compatible" content="ie=edge">
		<title>test </title>
		<style>
			#content{
				height: 100%;
				width: 100%;
				margin: auto;
				position: relative;
				left: 35%;
			}
		</style>
			 <body>
				<div id="content">
					<div >
					<canvas id="canvas" width="650" height="750" style="border: 1px solid;"/>
					<!-- <audio id="a1" src="../music/nvEQ.mp3"  ></audio> -->
					</div>
					
					<button id="start">開始計時</button>
					<p id="p1">dddddddddddd</p>
					
				</div>
				<section id="game">		
				<div id="cards">			
					<div class="card">
						<div class="face front"></div>
						<div class="face back"></div>
					</div> <!-- .card -->						
				</div> <!-- #cards -->
			</section> <!-- #game -->	
			</body>
		<script type="text/javascript" src="./jquery-3.5.1.min.js"></script>
		<script type="text/javascript">
		    var i=0;//計時用到
			var ctx;
			var canvas;
			var card;//卡牌
			var first_pick = true;//第一次點擊的標志	 		
			var first_card = -1;
			var second_card;
			var back_color = "rgb(55,100,100)";//卡片背面顏色			
			var table_color = "#FFF"; 
			var deck = [];//卡牌數組
			//note
			var first_x = 50;//初始坐標X
			var first_y = 10;//初始坐標Y
			var margin = 10;//卡牌余卡牌之間的間距
			var card_width = 130;//卡牌的寬
			var card_height = 175;//卡牌的高
			//定義卡牌正面圖片
			var pairs = [["img/1_a.png", "img/1_b.png"],["img/2_a.png", "img/2_b.png"], ["img/3_a.png", "img/3_b.png"], ["img/4_a.png", "img/4_b.png"], ["img/5_a.png", "img/5_b.png"], ["img/6_a.png", "img/6_b.png"], ["img/7_a.png", "img/7_b.png"], ["img/8_a.png", "img/8_b.png"]];
			//繪制卡片背面
			function draw_back()
			{
				ctx.fillStyle = back_color;
				
				ctx.fillRect(this.sx, this.sy, this.swidth, this.sheight);
			}
            //定義牌的屬性：x,y坐標，長寬，背景圖片，信息
			function Card(sx, sy, swidth, sheight, img, info)//構造函數
			{
				this.sx = sx;
				this.sy = sy;
				this.swidth = swidth;
				this.sheight = sheight;
				this.info = info;
				this.img = img;
				this.draw = draw_back;//繪制了背面
			}

			function make_deck()//生成卡組並繪制
			{
				var i;//
				var a_card;//a組卡牌容器
				var b_card;//b組卡牌容器
				var a_pic;//a組卡牌圖片
				var b_pic;//b組卡牌圖片
				var cx = first_x;//初始坐標X=50
				var cy = first_y;//初始坐標Y=10
				for ( i = 0; i < pairs.length/2; i++) {
					
                     
					a_pic = new Image();
					a_pic.src = pairs[i][0];
					//繪制卡牌a組
					a_card = new Card(cx, cy, card_width, card_height, a_pic, i);//給卡牌屬性即卡牌對象生成了，並繪制了背面
					deck.push(a_card);//將a組卡牌裝進數組deck[]
				
					//繪制與之a組卡牌面相同的b組
					b_pic = new Image();
					b_pic.src = pairs[i][1];
					b_card = new Card(cx, cy + card_height + margin, card_width, card_height, b_pic, i);
					deck.push(b_card);// 將b組卡牌裝進數組deck[]
					cx = cx + card_width  + margin;
					//cy = cy + card_height + margin; 
					//note
					a_card.draw();
					b_card.draw();
				}
				//繪制后兩排
				cx=first_x;
				cy=first_y+card_height*2+margin*2;
				for ( i = 4; i < pairs.length; i++) {
					a_pic = new Image();
					a_pic.src = pairs[i][0];
					//繪制卡牌a組
					a_card = new Card(cx, cy, card_width, card_height, a_pic, i);
					deck.push(a_card);
				
					//繪制與之a組卡牌面相同的b組
					b_pic = new Image();
					b_pic.src = pairs[i][1];
					b_card = new Card(cx, cy + card_height + margin, card_width, card_height, b_pic, i);
					deck.push(b_card);// 
					cx = cx + card_width + margin;
					//cy = cy + card_height + margin; 
					//note
					a_card.draw();
					b_card.draw();
				}
			}

			function shuffle()//洗牌
			{
				var i;
				var j;
				var temp_info;
				var temp_img;
				var deck_length = deck.length;
				var k;
				for ( k = 0; k < 9 * deck_length; k++) {
					i = Math.floor(Math.random() * deck_length);//0-16
					j = Math.floor(Math.random() * deck_length);//0-16
					temp_info = deck[i].info;//第1張
					temp_img = deck[i].img;//第1張圖片
					deck[i].info = deck[j].info;
					deck[i].img = deck[j].img;
					deck[j].info = temp_info;
					deck[j].img = temp_img;
				}
			}

			function choose(ev) {
				//var out;
				var mx;
				var my;
				//var pick1;
				//var pick2;
				var i;
				//note
				if (ev.layerX || ev.layerX == 0) {// Firefox
					mx = ev.layerX;
					my = ev.layerY;
				} else if (ev.offsetX || ev.offsetX == 0) {// Opera
					mx = ev.offsetX;
					my = ev.offsetY;
				}
				for ( i = 0; i < deck.length; i++) {
					card = deck[i];
					if (card.sx >= 0)//牌未被消除
					{
						//判斷點擊的是哪一張牌
						if (mx > card.sx && mx < card.sx + card.swidth && my > card.sy && my < card.sy + card.sheight) {
							if (i != first_card)//如果兩次點擊同一張牌不做處理
								break;
						}
					}
				}
				if (i < deck.length) {
					if (first_pick)//如果是第一次點擊
					{
                        window.addEventListener("load",function(){
                           var myaudio=document.getElementByIdx_x("a1");
                           myaudio.volume=0.5;//表示的是播放音量為一半
                           myaudio.play();
                           alert("shengyin");
                       });
						first_card = i;
						first_pick = false;
						//note
						ctx.drawImage(card.img, card.sx, card.sy, card.swidth, card.sheight);
					} else {
						first_pick = true;
						//note
						second_card = i;
						ctx.drawImage(card.img, card.sx, card.sy, card.swidth, card.sheight);
						tid = setTimeout(flip_back, 1000);
					}
				}
			}

			function flip_back() { 
				if (card.info==deck[first_card].info)//配對成功
				{
					ctx.fillStyle = table_color;
					ctx.fillRect(deck[first_card].sx, deck[first_card].sy, deck[first_card].swidth, deck[first_card].sheight);
					ctx.fillRect(deck[second_card].sx, deck[second_card].sy, deck[second_card].swidth, deck[second_card].sheight);
					deck[first_card].sx = -1;
					deck[second_card].sy = -1;
					first_card = -1;
					
				     gg();					
				} else {
					deck[first_card].draw();
					deck[second_card].draw(); 
					first_card = -1;
				}
			}
            
			function init() {
				canvas = document.getElementById('canvas');
				canvas.addEventListener('click', choose, false);
				ctx = canvas.getContext('2d');
				
				make_deck();//生成卡組並繪制
				shuffle();//洗牌
			}
			function jishi(){ 
				//alert("----------")
				i++;
				//alert(i)
				document.getElementById("p1").innerHTML=i
				//alert("----------")
				if(i>60){
					 init(); 
					document.getElementById("p1").innerHTML="時間到"
				}
			}
			$(window).ready(function(){
				   init(); 
			  $("#start").click(function(){
			  	    setInterval("jishi()", 1000); 
			         
			   });
			});
			
		</script>
	</head>

</html>
		
		
